# ADR-003: Communication Protocol Stack Integration

## Title
Communication Protocol Stack Integration and Fallback Logic

## Status
Proposed

## Context
The device must support Matter over Thread (Zigbee-based) and Wi-Fi, with automatic fallback and secure commissioning. ESP32-C6 supports both protocols, but integration and fallback logic must be robust and user-friendly.

## Alternatives
### Alternative 1: Single Protocol (Wi-Fi Only)
- Only support Matter over Wi-Fi
- Pros: Simpler, easier initial development
- Cons: No mesh networking, limited future-proofing

### Alternative 2: Dual Protocol with Manual Selection
- User selects Thread or Wi-Fi via configuration
- Pros: User control, clear status
- Cons: Manual intervention required, less seamless

### Alternative 3: Dual Protocol with Automatic Fallback (Recommended)
- Device attempts Thread first, falls back to Wi-Fi if unavailable
- Status LED indicates current mode
- Last successful mode saved in NVS
- Pros: Seamless user experience, robust connectivity, future-proof
- Cons: More complex logic, requires thorough testing

## Decision
Alternative 3: Implement dual protocol support with automatic fallback and clear user feedback.
- Device tries Thread first, falls back to Wi-Fi
- User can override via web interface or app
- Status LED and NVS used for feedback and persistence

## Consequences
- Robust, user-friendly connectivity
- Increased development and testing complexity
- Requires careful documentation and error handling

## References
- [ESP-IDF Thread and Wi-Fi documentation](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/network/index.html)
- [architecture.md](../../architecture.md)
