# ADR-002: Hardware Abstraction and Sensor Interface

## Title
Hardware Abstraction and Sensor Interface Design

## Status
Proposed

## Context
The firmware must reliably interface with reed sensors and logic ICs for window and handle position detection. Hardware abstraction is needed for maintainability and testability. ESP32-C6 supports GPIO, ADC, and hardware interrupts.

## Alternatives
### Alternative 1: Direct GPIO Access in Application Code
- Access sensors directly in main logic
- Pros: Simple, minimal abstraction
- Cons: Hard to test, poor maintainability, tightly coupled code

### Alternative 2: Hardware Abstraction Layer (HAL) (Recommended)
- Create a HAL for all sensor and peripheral access
- Abstract reed sensor debouncing, flip-flop logic, and status LED
- Pros: Easier testing, maintainable, supports hardware changes
- Cons: Requires initial design effort

### Alternative 3: Use ESP-IDF Driver Model
- Use ESP-IDF drivers for all peripherals
- Pros: Standardized, leverages Espressif support
- Cons: May require custom drivers for logic ICs

## Decision
Alternative 2: Implement a Hardware Abstraction Layer (HAL) for all sensor and peripheral access, including debouncing and wakeup logic.
- HAL exposes clean APIs for sensor state, LED control, and setup button.
- Application logic interacts only with HAL, not raw GPIO.

## Consequences
- Improved maintainability and testability
- Easier hardware upgrades or changes
- Initial design and documentation effort required

## References
- [ESP-IDF GPIO documentation](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/gpio.html)
- [architecture.md](../../architecture.md)
