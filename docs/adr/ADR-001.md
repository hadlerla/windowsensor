# ADR-001: Firmware System Architecture

## Title
Firmware System Architecture: Structure, Task Management, State Management

## Status
Proposed

## Context
The firmware must be maintainable, scalable, and support low-power operation. Key architectural choices include overall structure, task management, and state handling. The ESP32-C6 hardware supports FreeRTOS, event-driven programming, and deep sleep modes.

## Alternatives
### Alternative 1: Monolithic Firmware
- All logic in a single main loop or file
- Pros: Simple, easy for small projects
- Cons: Hard to maintain, poor scalability, difficult testing

### Alternative 2: Modular Component-Based Architecture (Recommended)
- Separate modules for sensor interface, communication, power management, etc.
- Use FreeRTOS tasks for concurrency
- Event-driven state transitions
- Pros: Maintainable, scalable, easier testing, supports low-power design
- Cons: More initial design effort, requires clear interfaces

### Alternative 3: Layered Architecture
- Hardware abstraction, middleware, application layers
- Pros: Clear separation, good for large teams
- Cons: May be overkill for this project size

## Decision
Alternative 2: Modular component-based architecture using FreeRTOS tasks and event-driven state management.
- Each major function (sensor, comms, power, diagnostics) is a separate module.
- Use FreeRTOS tasks for concurrency and event queues for state transitions.
- Clear interfaces between modules.

## Consequences
- Easier maintenance and future feature additions
- Supports low-power operation and robust error handling
- Requires initial design effort and documentation

## References
- [ESP-IDF FreeRTOS documentation](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/freertos.html)
- [architecture.md](../../architecture.md)
